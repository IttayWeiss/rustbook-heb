## שליטה על אופן הרצת פונקציות מבחן

בדיוק כמו שהפקודה `cargo run` מקמפלת את הקוד שלכם ואז מריצה את הקובץ הבינרי שנוצר, כך הפקודה `cargo test` מקמפלת את הקוד לביצוע בדיקות ומריצה את קובץ הבדיקה הבינרי. ברירת המחדל עבור הקובץ הבינרי המופק על-ידי `cargo test` הוא להריץ את כל פונקציות המבחן במקביל ולאסוף את הפלט המופק במהלך הרצת הבדיקות, תוך הימנעות מהצגת הפלט ובכך להקל על קריאת הפלט הקשור לתוצאות המבחן. ניתן, למרות זאת, לציין אפשרויות שורת פקודה שמשנות התנהגות ברירת-מחדל זו.

חלק מאפשרויות שורת הפקודה מועברות ל-`cargo test`, וחלקן מועברות לקובץ הבדיקה הבינרי. כדי להפריד בין שני סוגי ארגומנטים אלו, רושמים את הארגומנטים שמועברים ל-`cargo test`, אז את סימן ההפרדה `--`, ולאחריו את הארגומנטים שמועברים לקובץ הבינרי. הרצת הפקודה `cargo test --help` מציגה את האפשרויות שזמינות לשימוש עם `cargo test`, והרצה של `cargo test -- --help` מציגה את האפשרויות שניתן לציין לאחר סימן ההפרדה.

### הרצת בדיקות במקביל

כאשר מריצים בדיקות רבות, ברירת המחדל היא להריץ אותן במקביל תוך שימוש בפתילים, כך שהריצה לוקחת פחות זמן ומקבלים תוצאות מהר יותר. כיוון שהבדיקות רצות באותו הזמן, יש לוודא שהבדיקות לא מסתמכות זו על זו או על מצבים משותפים, כולל סביבה משותפת, כמו התיקיה הנוכחית או משתני סביבה.

לדוגמא, נניח שכל אחת מהבדיקות מריצה קוד כלשהו שיוצר קובץ על הדיסק בשם _test-output.txt_ וכותב לתוכו דאטה מסוים. אחר כך, כל בדיקה קוראת את הדאטה בקובץ ומוודאת שהוא מכיל ערך ספציפי, ובכל בדיקה ערך זה שונה. היות והבדיקות רצות באותו זמן, אחת הבדיקות עלולה לשכתב את הקובץ בדיוק בזמן בין כתיבת הערך ווידוא הערך בבדיקה אחרת. כך הבדיקה השניה תכשל, לא משום שהקוד שגוי אלא בגלל שהמבחנים מפריעים זה לזה בזמן ההרצה המקבילית. פתרון אחד לבעיה זו הוא לוודא שכל בדיקה כותבת לקובץ שונה; פתרון שני הוא להריץ את הבדיקות אחת-אחת.

אם אינכם רוצים להריץ את הבדיקות במקביל או אם אתם מעוניינים בשליטה עדינה על מספר הפתילים בשימוש, תוכלו להעביר לקובץ הבינרי של הבדיקות את הדגל `--test-threads` ואת מספר הפתילים בו אתם מעוניינים. הביטו בדוגמא הבאה:

```console
$ cargo test -- --test-threads=1
```

אנו קובעים את מספר הפתילים ל-`1`, ובכך אומרים לתוכנית לא לבצע הרצה במקביל. הרצת הבדיקות עם פתיל אחד תארך יותר זמן מאשר בהרצה מקבילית, אבל הבדיקות לא יפריעו אחת לשניה במידה והן חולקות מצבים.

### הצגת פלט הפונקציות

כברירת מחדל, אם בדיקה עוברת בהצלחה, ספרית הבדיקות של ראסט שומרת כל דבר שהודפס לפלט הסטנדרטי. למשל, אם אנו קוראים ל-`println!` מתוך פונקצית מבחן והמבחן עובר בהצלחה, לא רואים אם הפלט של `println!` בטרמינל; כל שנראה הוא שורה שמציינת שהמבחן צלח. במקרה של כישלון, נראה, יחד עם הודעת השגיאה, גם את כל מה שהודפס לפלט הסטנדרטי.

כדוגמא, רשימה 11-10 כוללת פונקציה טפשית שמדפיסה את הערך של הפרמטר שלה ומחזירה את הערך 10, פונקצית מבחן שעובר בהצלחה, ואחד שכושל.

<span class="filename">Filename: src/lib.rs</span>

```rust,panics,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-10/src/lib.rs}}
```

<span class="caption">רשימה 11-10: מקרי מבחן עבור פונקציה שקוראת -`println!`</span>

כאשר מריצים מבחנים אלה עם `cargo test`, מקבלים את הפלט הבא:

```console
{{#include ../listings/ch11-writing-automated-tests/listing-11-10/output.txt}}
```

שימו לב שבשום מקום בפלט זה לא מופיע `I got the value 4`, שהוא מה שמודפס כאשר המבחן שעובר בהצלחה מורץ. פלט זה נשמר על-ידי מריץ המבחנים. הפלט מהמבחן שנכשל, קריא `I got the value 8`, מופיע בחלק של סיכום הרצת המבחנים, שגם מראה את סיבת הכישלון למבחן שכשל.

אם נרצה לראות את הפלט גם של מבחנים שעוברים בהצלחה, ניתן לאמר לראסט להציג את הפלט גם של מבחנים כאלה תוך שימוש ב-`--show-output`.

```console
$ cargo test -- --show-output
```

אם נריץ שוב את הבדיקות מרשימה 11-10, הפעם עם הדגל `--show-output`, נקבל את הפלט הבא:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-01-show-output/output.txt}}
```

### הרצת תת-קבוצה של מבחנים

לעיתים, הרצת כל הבדיקות כולן עלול לקחת זמן רב. אם אתם עובדים על קוד ספציפי, יתכן ותרצו להריץ רק את הבדיקות הקשורות לאיזור זה של הקוד. ניתן לבחור אלו בדיקות להריץ על-ידי העברת שמות הבדיקות ל-`cargo test` שאותן אתם מעוניינים להריץ.

על-מנת להדגים הרצה של תת-קבוצה של בדיקות, ראשית ניצור שלושה מבחנים עבור הפונקציה `add_two`, כמוצג ברשימה 11-11, ונבחר אלו מבינהן להריץ.

<span class="filename">Filename: src/lib.rs</span>

```rust,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-11/src/lib.rs}}
```

<span class="caption">רשימה 11-11: שלושה מבחנים בעלי שמות שונים</span>

אם נריץ את המבחנים ללא העברת ארגומנטים, כפי שעשינו עד כה, כל הבדיקות יתבצעו במקביל:

```console
{{#include ../listings/ch11-writing-automated-tests/listing-11-11/output.txt}}
```

#### הרצת מבחן בודד

ניתן להעביר ל-`cargo test` את השם של פונקצית הבדיקה כדי להריץ רק אותה:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-02-single-test/output.txt}}
```

רק הבדיקה בשם `one_hundred` הורצה; שתי הבדיקות האחרונות לא הותאמו לשם זה. פלט המבחן מיידע אותנו שישנן עוד בדיקות שלא הורצו על-ידי הצגת `2 filtered out` בסוף הפלט.

לא ניתן להעביר מספר בדיקות להרצה בצורה זו; רק הערך הראשון המועבר ל-`cargo test` ישמש למטרה זו. אבל ישנה דרך להרצת מספר בדיקות.

#### הרצת מספר בדיקות על-ידי סינון

ניתן לציין חלק משם של מבחן, ואז יורץ כל מבחן ששמו מותאם לערך זה. למשל, כיוון ששמות שניים מהמבחנים שלנו כוללים את המחרוזת `add`, נוכל להריץ את רק אותם באמצעות הפקודה `cargo test add`:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-03-multiple-tests/output.txt}}
```

פקודה זו הריצה את כל הבחינות ששמן מכיל `add` וסיננה את המבחן בשם `one_hundred`. בנוסף, שימו לב שהמודול בו המבחנים כתובים הינו חלק משם המבחנים, וכך ניתן בקלות להריץ את כל המבחנים ממודול מסוים על-ידי סינון לפי שם המודול.

### התעלמות מבדיקות מסוימות אלה אם כן דורשים אחרת

לעיתים הרצת בדיקות מסוימות יכולה לגזול זמן חישוב רב, ולכן יתכן ותרצו להתעלם מהן עבור רוב ההרצות של `cargo test`. במקום לרשום כארגומנטים את כל הבדיקות שאתם כן רוצים להריץ, ניתן במקום זאת לבאר את הבדיקות האינטנסיביות חישובית בתכונה `ignore` על מנת למנוע את הרצתן, כפי שמוצג כאן:

<span class="filename">Filename: src/lib.rs</span>

```rust,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/no-listing-11-ignore-a-test/src/lib.rs}}
```

לאחר ה-`#[test]` אנו מוסיפים את השורה `#[ignore]` למבחן שאותו אנו רוצים להימנע מלהריץ. כעת, כאשר נריץ את הבדיקות, `it_works` תבוצע אולם `expensive_test` לא תבוצע:

```console
{{#include ../listings/ch11-writing-automated-tests/no-listing-11-ignore-a-test/output.txt}}
```

הפונקציה `expensive_test` מופיעה כ-`ignored`. אם נרצה להריץ רק את הבדיקות מהם בדרך-כלל מתעלמים, נוכל לעשות זאת על-ידי הפקודה `cargo test -- --ignored`:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-04-running-ignored/output.txt}}
```

תוך כדי שליטה על אלו בדיקות רצות ומתי, תוכלו לוודא שהתוצאות של `cargo test` יתקבלו במהירות. כאשר אתם במצב בו הגיוני להריץ את הבדיקות מהן בדרך-כלל עדיף להימנע, ויש לכם זמן להמתין לתוצאות, תוכלו להריץ את הפקודה `cargo test -- --ignored`. במידה ותרצו להריץ את כל הבדיקות כולן, בין אם הן מסומנות להתעלמות ובין אם לאו, תוכלו להריץ את הפקודה `cargo test -- --include-ignored`.
